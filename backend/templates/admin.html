<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel - Portfolio</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles/admin.css') }}">
</head>

<body>

  <div class="sidebar">
    <div class="logo"><i class="fas fa-rocket"></i> Admin Panel</div>
    <div class="nav-item active" onclick="switchView('projects')"><i class="fas fa-project-diagram"></i> Projects</div>
    <div class="nav-item" onclick="switchView('experience')"><i class="fas fa-briefcase"></i> Experience</div>
    <div class="nav-item" onclick="switchView('education')"><i class="fas fa-graduation-cap"></i> Education</div>
    <div class="nav-item" onclick="switchView('skills')"><i class="fas fa-code"></i> Skills</div>
    <div class="nav-item" onclick="switchView('certifications')"><i class="fas fa-certificate"></i> Certifications</div>
    <div class="nav-item" onclick="switchView('profile')"><i class="fas fa-user"></i> Profile</div>
    <div style="margin-top: auto;">
      <a href="/admin/backup" class="nav-item" style="color: var(--success); text-decoration: none;" download>
        <i class="fas fa-download"></i> Backup Database
      </a>
      <a href="/" target="_blank" class="nav-item"><i class="fas fa-external-link-alt"></i> View Site</a>
    </div>
  </div>

  <div class="main-content">
    <!-- Projects View -->
    <div id="view-projects" class="view-section">
      <div class="header">
        <h2>Projects</h2>
        <button class="btn btn-primary" onclick="openModal('project')"><i class="fas fa-plus"></i> Add Project</button>
      </div>
      <div class="item-list">
        {% for p in projects %}
        <div class="list-item">
          <div class="item-info">
            <h3>{{ p.title_es or p.slug }}</h3>
            <p>{{ p.category or '' }}</p>
          </div>
          <div class="item-actions">
            <button class="action-btn" onclick='editProject({{ p.id }})'><i class="fas fa-edit"></i></button>
            <button class="action-btn delete" onclick="deleteItem('project', {{ p.id }})"><i
                class="fas fa-trash"></i></button>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Experience View -->
    <div id="view-experience" class="view-section hidden">
      <div class="header">
        <h2>Experience</h2>
        <button class="btn btn-primary" onclick="openModal('experience')"><i class="fas fa-plus"></i> Add
          Experience</button>
      </div>
      <div class="item-list">
        {% for e in experiences %}
        <div class="list-item">
          <div class="item-info">
            <h3>{{ e.company }}</h3>
            <p>{{ e.role_es or '' }} • {{ e.start_date }} - {{ e.end_date or 'Present' }}</p>
          </div>
          <div class="item-actions">
            <button class="action-btn" onclick='editExperience({{ e.id }})'><i class="fas fa-edit"></i></button>
            <button class="action-btn delete" onclick="deleteItem('experience', {{ e.id }})"><i
                class="fas fa-trash"></i></button>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Education View -->
    <div id="view-education" class="view-section hidden">
      <div class="header">
        <h2>Education</h2>
        <button class="btn btn-primary" onclick="openModal('education')"><i class="fas fa-plus"></i> Add
          Education</button>
      </div>
      <div class="item-list">
        {% for e in education %}
        <div class="list-item">
          <div class="item-info">
            <h3>{{ e.institution }}</h3>
            <p>{{ e.degree_es or '' }} • {{ e.start_date }} - {{ e.end_date or 'Present' }}</p>
          </div>
          <div class="item-actions">
            <button class="action-btn" onclick='editEducation({{ e.id }})'><i class="fas fa-edit"></i></button>
            <button class="action-btn delete" onclick="deleteItem('education', {{ e.id }})"><i
                class="fas fa-trash"></i></button>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Skills View -->
    <div id="view-skills" class="view-section hidden">
      <div class="header">
        <h2>Skills</h2>
        <button class="btn btn-primary" onclick="openModal('skill')"><i class="fas fa-plus"></i> Add Skill</button>
      </div>
      <div class="item-list">
        {% for s in skills %}
        <div class="list-item">
          <div class="item-info">
            <h3>{{ s.name }}</h3>
            <p>{{ s.category or '' }} • {{ s.proficiency }}%</p>
          </div>
          <div class="item-actions">
            <button class="action-btn" onclick='editSkill({{ s.id }})'><i class="fas fa-edit"></i></button>
            <button class="action-btn delete" onclick="deleteItem('skill', {{ s.id }})"><i
                class="fas fa-trash"></i></button>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Certifications View -->
    <div id="view-certifications" class="view-section hidden">
      <div class="header">
        <h2>Certifications</h2>
        <button class="btn btn-primary" onclick="openModal('certification')"><i class="fas fa-plus"></i> Add
          Certification</button>
      </div>
      <div class="item-list">
        {% for c in certifications %}
        <div class="list-item">
          <div class="item-info">
            <h3>{{ c.slug }}</h3>
            <p>{{ c.issuer or '' }} • {{ c.issue_date or '' }}</p>
          </div>
          <div class="item-actions">
            <button class="action-btn" onclick='editCertification({{ c.id }})'><i class="fas fa-edit"></i></button>
            <button class="action-btn delete" onclick="deleteItem('certification', {{ c.id }})"><i
                class="fas fa-trash"></i></button>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Profile View -->
    <div id="view-profile" class="view-section hidden">
      <div class="header">
        <h2>Profile</h2>
        <button class="btn btn-primary" onclick="saveProfile()"><i class="fas fa-save"></i> Save Changes</button>
      </div>
      <div class="card" style="background: var(--bg-card); padding: 2rem; border-radius: 0.5rem;">
        <form id="profile-form">
          <div class="form-group">
            <label class="form-label">Name</label>
            <input type="text" class="form-control" name="name" value="{{ profile.name }}">
          </div>
          <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-control" name="email" value="{{ profile.email }}">
          </div>
          <div class="form-group">
            <label class="form-label">Location (JSON)</label>
            <input type="text" class="form-control" name="location" value='{{ profile.location | tojson }}'>
          </div>
          <div class="form-group">
            <label class="form-label">Social Links (JSON)</label>
            <input type="text" class="form-control" name="social" value='{{ profile.social_links | tojson }}'>
          </div>

          <div class="tabs">
            <div class="tab active" onclick="switchTab(this, 'profile-es')">Spanish</div>
            <div class="tab" onclick="switchTab(this, 'profile-en')">English</div>
          </div>

          {% set trans_es = profile.translations | selectattr('lang', 'equalto', 'es') | first %}
          {% set trans_en = profile.translations | selectattr('lang', 'equalto', 'en') | first %}

          <div id="profile-es" class="tab-content">
            <div class="form-group">
              <label class="form-label">Role (ES)</label>
              <input type="text" class="form-control" name="role_es" value="{{ trans_es.role if trans_es else '' }}">
            </div>
            <div class="form-group">
              <label class="form-label">Tagline (ES)</label>
              <input type="text" class="form-control" name="tagline_es"
                value="{{ trans_es.tagline if trans_es else '' }}">
            </div>
            <div class="form-group">
              <label class="form-label">Bio (ES)</label>
              <textarea class="form-control" name="bio_es">{{ trans_es.bio if trans_es else '' }}</textarea>
            </div>
          </div>

          <div id="profile-en" class="tab-content hidden">
            <div class="form-group">
              <label class="form-label">Role (EN)</label>
              <input type="text" class="form-control" name="role_en" value="{{ trans_en.role if trans_en else '' }}">
            </div>
            <div class="form-group">
              <label class="form-label">Tagline (EN)</label>
              <input type="text" class="form-control" name="tagline_en"
                value="{{ trans_en.tagline if trans_en else '' }}">
            </div>
            <div class="form-group">
              <label class="form-label">Bio (EN)</label>
              <textarea class="form-control" name="bio_en">{{ trans_en.bio if trans_en else '' }}</textarea>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Generic Modal -->
  <div id="edit-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modal-title">Edit Item</h3>
        <button class="action-btn" onclick="closeModal()"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body" id="modal-form-container">
        <!-- Form injected via JS -->
      </div>
      <div class="modal-header"
        style="border-top: 1px solid var(--border); border-bottom: none; justify-content: flex-end; gap: 1rem;">
        <button class="btn" style="background: var(--border)" onclick="closeModal()">Cancel</button>
        <button class="btn btn-primary" onclick="saveItem()">Save</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast">Action successful</div>

  <!-- Initialize data from server -->
  <script>
    window.projects = {{ projects | tojson }};
    window.experiences = {{ experiences | tojson }};
    window.education = {{ education | tojson }};
    window.skills = {{ skills | tojson }};
    window.certifications = {{ certifications | tojson }};
  </script>

  <script src="{{ url_for('static', filename='scripts/admin.js') }}"></script>
</body>

</html>