<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel{% if entity %} — {{ entity.slug }}{% endif %}</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800 px-6 py-8">

  <h1 class="text-3xl font-bold mb-6">Panel de Administración</h1>

  {% if entities %}
    <section class="mb-10">
      <label for="project-select" class="block text-sm font-medium text-gray-700 mb-2">Seleccionar proyecto</label>
      <div class="flex items-center gap-4">
        <select id="project-select" class="border rounded-md px-3 py-2" onchange="location.href='/admin?ready=true&edit=' + this.value">
          <option value="">-- Selecciona --</option>
          {% for e in entities %}
            <option value="{{ e.id }}" {% if entity and entity.id == e.id %}selected{% endif %}>
              {{ e.slug }} — {{ e.type or 'Sin tipo' }}
            </option>
          {% endfor %}
        </select>
        <a href="{{ url_for('admin.admin_home', ready='true') }}" class="text-sm px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">+ Nuevo proyecto</a>
      </div>
    </section>
  {% endif %}

  <section class="bg-white shadow rounded-md p-6">
    <h2 class="text-xl font-semibold mb-4">{% if entity %}Editar{% else %}Crear nuevo{% endif %} proyecto</h2>

    <form id="main-form" method="post" action="{{ url_for('admin.admin_save') }}" class="space-y-6">
      {% if entity %}
        <input type="hidden" name="id" value="{{ entity.id }}">
      {% endif %}

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <label>
          <span class="block text-sm font-medium">Slug</span>
          <input type="text" name="slug" required value="{{ entity.slug if entity else '' }}"
            class="mt-1 w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" />
        </label>

        <label>
          <span class="block text-sm font-medium">Type</span>
          <input type="text" name="type" value="{{ entity.type if entity else '' }}"
            class="mt-1 w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" />
        </label>

        <label>
          <span class="block text-sm font-medium">Category</span>
          <input type="text" name="category" value="{{ entity.meta.category if entity else '' }}"
            class="mt-1 w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" />
        </label>

        <label>
          <span class="block text-sm font-medium">Tags (comma-separated)</span>
          <input type="text" name="tags" value="{{ entity.meta.tags | join(', ') if entity else '' }}"
            class="mt-1 w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" />
        </label>
      </div>

      <!-- Image Uploads -->
      <div class="col-span-full mt-6">
        <h3 class="text-lg font-semibold mb-4">Project Images</h3>
        <div class="grid md:grid-cols-2 gap-6">
          <!-- Desktop Image -->
          <div>
            <label class="block text-sm font-medium mb-2">Desktop Image</label>
            <input type="file" id="desktop-image-input" accept="image/*"
              class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
            <input type="hidden" id="desktop-image-url" name="desktop_image" value="{{ entity.meta.images.desktop if entity and entity.meta and entity.meta.images else '' }}">
            <div id="desktop-image-preview" class="mt-4 min-h-[100px] border-2 border-dashed border-gray-300 rounded-lg p-4 flex items-center justify-center">
              {% if entity and entity.meta and entity.meta.images and entity.meta.images.desktop %}
                <img src="{{ entity.meta.images.desktop }}" class="max-w-full h-auto rounded" alt="Desktop preview">
              {% else %}
                <p class="text-gray-400">No image uploaded</p>
              {% endif %}
            </div>
          </div>

          <!-- Mobile Image -->
          <div>
            <label class="block text-sm font-medium mb-2">Mobile Image</label>
            <input type="file" id="mobile-image-input" accept="image/*"
              class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
            <input type="hidden" id="mobile-image-url" name="mobile_image" value="{{ entity.meta.images.mobile if entity and entity.meta and entity.meta.images else '' }}">
            <div id="mobile-image-preview" class="mt-4 min-h-[100px] border-2 border-dashed border-gray-300 rounded-lg p-4 flex items-center justify-center">
              {% if entity and entity.meta and entity.meta.images and entity.meta.images.mobile %}
                <img src="{{ entity.meta.images.mobile }}" class="max-w-full h-auto rounded" alt="Mobile preview">
              {% else %}
                <p class="text-gray-400">No image uploaded</p>
              {% endif %}
            </div>
          </div>
        </div>

        <!-- Preview Video/GIF (for hover effect) -->
        <div class="mt-6">
          <label class="block text-sm font-medium mb-2">Preview Video/GIF URL (optional - for hover effect)</label>
          <input type="text" name="preview_video" value="{{ entity.meta.images.preview_video if entity and entity.meta and entity.meta.images and entity.meta.images.preview_video else '' }}"
            placeholder="https://res.cloudinary.com/your-cloud-name/video/upload/..."
            class="mt-1 w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" />
          <p class="text-sm text-gray-500 mt-2">Enter a Cloudinary video URL (MP4, WebM) or animated GIF. This will play when users hover over the project card.</p>
        </div>
      </div>

      <div class="col-span-full">
        <hr class="my-6">
      </div>

      <div class="grid md:grid-cols-2 gap-6">
        <!-- Spanish Translation -->
        {% set t_es = translations.get('es') %}
        <div class="p-4 border rounded-md bg-gray-50">
          <h3 class="font-semibold text-gray-700 mb-2">Español (ES)</h3>
          <input type="hidden" name="lang_es" value="es">

          <div class="grid gap-4">
            <label>
              <span class="block text-sm font-medium">Título</span>
              <input type="text" name="title_es" value="{{ t_es.title if t_es else '' }}"
                class="mt-1 w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" />
            </label>

            <label>
              <span class="block text-sm font-medium">Subtítulo</span>
              <input type="text" name="subtitle_es" value="{{ t_es.subtitle if t_es else '' }}"
                class="mt-1 w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" />
            </label>

            <label>
              <span class="block text-sm font-medium">Descripción</span>
              <textarea name="description_es" rows="3"
                class="mt-1 w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">{{ t_es.description if t_es else '' }}</textarea>
            </label>

            <label>
              <span class="block text-sm font-medium">Resumen</span>
              <textarea name="summary_es" rows="2"
                class="mt-1 w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">{{ t_es.summary if t_es else '' }}</textarea>
            </label>

            <label>
              <span class="block text-sm font-medium">Contenido extra (JSON)</span>
              <textarea name="content_es" rows="4"
                class="mt-1 w-full font-mono border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">{{ t_es.content | tojson if t_es and t_es.content else '{}' }}</textarea>
            </label>
          </div>
        </div>

        <!-- English Translation -->
        {% set t_en = translations.get('en') %}
        <div class="p-4 border rounded-md bg-gray-50">
          <h3 class="font-semibold text-gray-700 mb-2">English (EN)</h3>
          <input type="hidden" name="lang_en" value="en">

          <div class="grid gap-4">
            <label>
              <span class="block text-sm font-medium">Title</span>
              <input type="text" name="title_en" value="{{ t_en.title if t_en else '' }}"
                class="mt-1 w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" />
            </label>

            <label>
              <span class="block text-sm font-medium">Subtitle</span>
              <input type="text" name="subtitle_en" value="{{ t_en.subtitle if t_en else '' }}"
                class="mt-1 w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" />
            </label>

            <label>
              <span class="block text-sm font-medium">Description</span>
              <textarea name="description_en" rows="3"
                class="mt-1 w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">{{ t_en.description if t_en else '' }}</textarea>
            </label>

            <label>
              <span class="block text-sm font-medium">Summary</span>
              <textarea name="summary_en" rows="2"
                class="mt-1 w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">{{ t_en.summary if t_en else '' }}</textarea>
            </label>

            <label>
              <span class="block text-sm font-medium">Extra content (JSON)</span>
              <textarea name="content_en" rows="4"
                class="mt-1 w-full font-mono border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">{{ t_en.content | tojson if t_en and t_en.content else '{}' }}</textarea>
            </label>
          </div>
        </div>
      </div>
    </form>
    {% if entity %}
  <form id="delete-form" method="post" onsubmit="return confirm('¿Eliminar este proyecto?')" class="hidden">
    <input type="hidden" name="delete_id" id="delete-id" value="{{ entity.id }}">
  </form>
    {% endif %}

    <div class="flex gap-4 mt-6">
      <button type="submit" form="main-form" name="action" value="draft"
        class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300">
        Guardar como borrador
      </button>

      <button type="submit" form="main-form" name="action" value="publish"
        class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
        Publicar
      </button>

      {% if entity %}
        <button type="submit" form="delete-form"
          class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">
          Eliminar
        </button>
      {% endif %}
    </div>
  </section>

  <script src="{{ url_for('static', filename='scripts/admin.js') }}"></script>
</body>
</html>
